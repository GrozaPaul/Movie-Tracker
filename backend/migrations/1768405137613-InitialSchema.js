export class InitialSchema1768405137613 {
  async up(queryRunner) {
    await queryRunner.query(`
      CREATE TABLE "user" (
        "user_id" bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
        "username" varchar(255) NOT NULL,
        "email" varchar(255) NOT NULL,
        "password" varchar(255) NOT NULL,
        "description" text DEFAULT '',
        "profile_picture" varchar(500)
      )
    `);

    await queryRunner.query(`
      CREATE TABLE "movie" (
        "movie_id" bigint PRIMARY KEY,
        "title" varchar(255),
        "overview" varchar(255),
        "release_date" varchar(255),
        "backdrop_path" varchar(255),
        "poster_path" varchar(255),
        "runtime" bigint,
        "country" varchar(20),
        "original_language" varchar(50),
        "spoken_languages" varchar(50)[],
        "director" varchar(255)
      )
    `);

    await queryRunner.query(`
      CREATE TABLE "user_follow" (
        "follower_id" bigint,
        "following_id" bigint,
        PRIMARY KEY ("follower_id", "following_id")
      )
    `);

    await queryRunner.query(`
      CREATE TABLE "studio_movies" (
        "movie_id" bigint,
        "studio_name" varchar(100),
        PRIMARY KEY ("studio_name", "movie_id")
      )
    `);

    await queryRunner.query(`
      CREATE TABLE "movie_actor" (
        "movie_id" bigint,
        "actor_name" varchar(255),
        "character_name" varchar(255),
        PRIMARY KEY ("movie_id", "actor_name")
      )
    `);

    await queryRunner.query(`
      CREATE TABLE "watched_movie" (
        "user_id" bigint,
        "movie_id" bigint,
        "is_favorite" boolean DEFAULT false,
        "rating" bigint,
        "review" text,
        "watched_at" timestamp DEFAULT (now()),
        "watch_count" bigint DEFAULT 1,
        "logged" boolean DEFAULT false,
        "preferred_poster" varchar(255),
        PRIMARY KEY ("user_id", "movie_id")
      )
    `);

    await queryRunner.query(`
      CREATE TABLE "watch_list" (
        "user_id" bigint,
        "movie_id" bigint,
        "added_at" timestamp DEFAULT (now()),
        PRIMARY KEY ("user_id", "movie_id")
      )
    `);

    await queryRunner.query(`
      CREATE TABLE "movie_genre" (
        "movie_id" bigint,
        "genre_name" varchar(255),
        PRIMARY KEY ("movie_id", "genre_name")
      )
    `);

    await queryRunner.query(`
      CREATE TABLE "list" (
        "list_id" bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
        "user_id" bigint,
        "list_name" varchar(255),
        "description" text,
        "created_at" timestamp DEFAULT (now()),
        "is_public" boolean DEFAULT false 
      )
    `);

    await queryRunner.query(`
      CREATE TABLE "list_movie" (
        "list_id" bigint,
        "movie_id" bigint,
        PRIMARY KEY ("list_id", "movie_id")
      )
    `);

    await queryRunner.query(`
      CREATE TABLE "tag" (
        "user_id" bigint,
        "movie_id" bigint,
        "tag_name" varchar(255),
        PRIMARY KEY ("user_id", "movie_id", "tag_name")
      )
    `);

    await queryRunner.query(`
      CREATE TABLE "plan" (
        "user_id" bigint,
        "movie_id" bigint,
        "planned_date" timestamp,
        "is_completed" boolean DEFAULT false,
        PRIMARY KEY ("user_id", "movie_id", "planned_date")
      )
    `);

    await queryRunner.query(`CREATE UNIQUE INDEX ON "user" ("email")`);
    await queryRunner.query(`CREATE UNIQUE INDEX ON "user" ("username")`);
    await queryRunner.query(
      `CREATE UNIQUE INDEX ON "list" ("user_id", "list_name")`,
    );
    await queryRunner.query(
      `CREATE UNIQUE INDEX ON "plan" ("user_id", "movie_id", "planned_date")`,
    );

    await queryRunner.query(
      `ALTER TABLE "user_follow" ADD FOREIGN KEY ("follower_id") REFERENCES "user" ("user_id")`,
    );
    await queryRunner.query(
      `ALTER TABLE "user_follow" ADD FOREIGN KEY ("following_id") REFERENCES "user" ("user_id")`,
    );

    await queryRunner.query(
      `ALTER TABLE "tag" ADD FOREIGN KEY ("user_id") REFERENCES "user" ("user_id")`,
    );
    await queryRunner.query(
      `ALTER TABLE "tag" ADD FOREIGN KEY ("movie_id") REFERENCES "movie" ("movie_id")`,
    );

    await queryRunner.query(
      `ALTER TABLE "studio_movies" ADD FOREIGN KEY ("movie_id") REFERENCES "movie" ("movie_id")`,
    );

    await queryRunner.query(
      `ALTER TABLE "movie_actor" ADD FOREIGN KEY ("movie_id") REFERENCES "movie" ("movie_id")`,
    );

    await queryRunner.query(
      `ALTER TABLE "watched_movie" ADD FOREIGN KEY ("user_id") REFERENCES "user" ("user_id")`,
    );
    await queryRunner.query(
      `ALTER TABLE "watched_movie" ADD FOREIGN KEY ("movie_id") REFERENCES "movie" ("movie_id")`,
    );

    await queryRunner.query(
      `ALTER TABLE "watch_list" ADD FOREIGN KEY ("user_id") REFERENCES "user" ("user_id")`,
    );
    await queryRunner.query(
      `ALTER TABLE "watch_list" ADD FOREIGN KEY ("movie_id") REFERENCES "movie" ("movie_id")`,
    );

    await queryRunner.query(
      `ALTER TABLE "movie_genre" ADD FOREIGN KEY ("movie_id") REFERENCES "movie" ("movie_id")`,
    );

    await queryRunner.query(
      `ALTER TABLE "list" ADD FOREIGN KEY ("user_id") REFERENCES "user" ("user_id")`,
    );

    await queryRunner.query(
      `ALTER TABLE "list_movie" ADD FOREIGN KEY ("list_id") REFERENCES "list" ("list_id")`,
    );
    await queryRunner.query(
      `ALTER TABLE "list_movie" ADD FOREIGN KEY ("movie_id") REFERENCES "movie" ("movie_id")`,
    );

    await queryRunner.query(
      `ALTER TABLE "plan" ADD FOREIGN KEY ("user_id") REFERENCES "user" ("user_id")`,
    );
    await queryRunner.query(
      `ALTER TABLE "plan" ADD FOREIGN KEY ("movie_id") REFERENCES "movie" ("movie_id")`,
    );
  }

  async down(queryRunner) {
    await queryRunner.query(`DROP TABLE IF EXISTS "plan" CASCADE`);
    await queryRunner.query(`DROP TABLE IF EXISTS "tag" CASCADE`);
    await queryRunner.query(`DROP TABLE IF EXISTS "list_movie" CASCADE`);
    await queryRunner.query(`DROP TABLE IF EXISTS "list" CASCADE`);
    await queryRunner.query(`DROP TABLE IF EXISTS "movie_genre" CASCADE`);
    await queryRunner.query(`DROP TABLE IF EXISTS "watch_list" CASCADE`);
    await queryRunner.query(`DROP TABLE IF EXISTS "watched_movie" CASCADE`);
    await queryRunner.query(`DROP TABLE IF EXISTS "movie_actor" CASCADE`);
    await queryRunner.query(`DROP TABLE IF EXISTS "studio_movies" CASCADE`);
    await queryRunner.query(`DROP TABLE IF EXISTS "user_follow" CASCADE`);
    await queryRunner.query(`DROP TABLE IF EXISTS "movie" CASCADE`);
    await queryRunner.query(`DROP TABLE IF EXISTS "user" CASCADE`);
  }
}
